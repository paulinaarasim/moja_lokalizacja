<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Geolokalizacja z mapą</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    html, body, #root {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React i ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel do JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- React Leaflet -->
  <script src="https://unpkg.com/react-leaflet@4.2.1/dist/react-leaflet.umd.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { MapContainer, TileLayer, Marker, Popup } = ReactLeaflet;

    function GeoMap() {
      const [location, setLocation] = useState(null);
      const [error, setError] = useState(null);

      useEffect(() => {
        if (!navigator.geolocation) {
          setError("Geolokalizacja nie jest wspierana przez Twoją przeglądarkę");
          return;
        }

        navigator.geolocation.getCurrentPosition(
          (pos) => {
            setLocation({
              lat: pos.coords.latitude,
              lng: pos.coords.longitude,
            });
          },
          (err) => {
            setError("Błąd: " + err.message);
          }
        );
      }, []);

      if (error) {
        return <div style={{ padding: '20px', fontSize: '1.2em' }}>{error}</div>;
      }

      if (!location) {
        return <div style={{ padding: '20px', fontSize: '1.2em' }}>Ładowanie lokalizacji...</div>;
      }

      return (
        <MapContainer center={[location.lat, location.lng]} zoom={13} style={{ height: "100%", width: "100%" }}>
          <TileLayer
            attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
          />
          <Marker position={[location.lat, location.lng]}>
            <Popup>Jesteś tutaj</Popup>
          </Marker>
        </MapContainer>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<GeoMap />);
  </script>
</body>
</html>
